From 74a285112212c2bd9eabf504b12fb0b86e6a5d80 Mon Sep 17 00:00:00 2001
From: root <root@localhost.arpa>
Date: Sun, 10 Mar 2024 15:30:43 +0100
Subject: [PATCH 04/28] arm64: dts: allwinner: h616: Add CPU Operating

 Performance Points table

Add an Operating Performance Points table for the CPU cores to
enable Dynamic Voltage & Frequency Scaling on the H616.

Also add the needed cpu_speed_grade nvmem cell.
---
 .../dts/allwinner/sun50i-h616-cpu-opp.dtsi    | 105 +++++++++++++-----
 1 file changed, 80 insertions(+), 25 deletions(-)

diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h616-cpu-opp.dtsi b/arch/arm64/boot/dts/allwinner/sun50i-h616-cpu-opp.dtsi
index 36f2950367c6..5934dce535bb 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h616-cpu-opp.dtsi
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h616-cpu-opp.dtsi
@@ -9,51 +9,106 @@ cpu_opp_table: opp-table-cpu {
 		opp-shared;
  
 		opp-480000000 {
-			clock-latency-ns = <244144>; /* 8 32k periods */
 			opp-hz = /bits/ 64 <480000000>;
-			opp-microvolt-speed0 = <820000 820000 1100000>; 
-			opp-microvolt-speed1 = <880000 880000 1100000>;
-			opp-microvolt-speed2 = <880000 880000 1100000>;
+			opp-microvolt-speed0 = <900000>;
+			opp-microvolt-speed1 = <900000>;
+			opp-microvolt-speed2 = <900000>;
+			opp-microvolt-speed3 = <900000>;
+			opp-microvolt-speed4 = <900000>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0x1f>;
 		};
-	
+
 		opp-600000000 {
-			clock-latency-ns = <244144>; /* 8 32k periods */
 			opp-hz = /bits/ 64 <600000000>;
-			opp-microvolt-speed0 = <820000 820000 1100000>;
-			opp-microvolt-speed1 = <880000 880000 1100000>;
-			opp-microvolt-speed2 = <880000 880000 1100000>;
+			opp-microvolt-speed1 = <900000>;
+			opp-microvolt-speed4 = <900000>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0x12>;
 		};
 
-		opp-792000000 {
+		opp-720000000 {
+			opp-hz = /bits/ 64 <720000000>;
+			opp-microvolt-speed0 = <900000>;
+			opp-microvolt-speed2 = <900000>;
+			opp-microvolt-speed3 = <900000>;
 			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0xd>;
+		};
+
+		opp-792000000 {
 			opp-hz = /bits/ 64 <792000000>;
-		        opp-microvolt-speed0 = <860000 860000 1100000>;
-			opp-microvolt-speed1 = <940000 940000 1100000>;
-			opp-microvolt-speed2 = <940000 940000 1100000>;
+			opp-microvolt-speed1 = <900000>;
+			opp-microvolt-speed4 = <940000>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0x12>;
 		};
 
-		opp-1008000000 {
+		opp-936000000 {
+			opp-hz = /bits/ 64 <936000000>;
+			opp-microvolt-speed0 = <900000>;
+			opp-microvolt-speed2 = <900000>;
+			opp-microvolt-speed3 = <900000>;
 			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0xd>;
+		};
+
+		opp-1008000000 {
 			opp-hz = /bits/ 64 <1008000000>;
-			opp-microvolt-speed0 = <900000 900000 1100000>;
-			opp-microvolt-speed1 = <1020000 1020000 1100000>;
-			opp-microvolt-speed2 = <1020000 1020000 1100000>;
+			opp-microvolt-speed0 = <950000>;
+			opp-microvolt-speed1 = <940000>;
+			opp-microvolt-speed2 = <950000>;
+			opp-microvolt-speed3 = <950000>;
+			opp-microvolt-speed4 = <1020000>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0x1f>;
 		};
 
-		opp-1200000000 {
+		opp-1104000000 {
+			opp-hz = /bits/ 64 <1104000000>;
+			opp-microvolt-speed0 = <1000000>;
+			opp-microvolt-speed2 = <1000000>;
+			opp-microvolt-speed3 = <1000000>;
 			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0xd>;
+		};
+
+		opp-1200000000 {
 			opp-hz = /bits/ 64 <1200000000>;
-			opp-microvolt-speed0 = <960000 960000 1100000>;
-			opp-microvolt-speed1 = <1100000 1100000 1100000>;
-			opp-microvolt-speed2 = <1100000 1100000 1100000>;
+			opp-microvolt-speed0 = <1050000>;
+			opp-microvolt-speed1 = <1020000>;
+			opp-microvolt-speed2 = <1050000>;
+			opp-microvolt-speed3 = <1050000>;
+			opp-microvolt-speed4 = <1100000>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0x1f>;
 		};
 
-		opp-1512000000 {
+		opp-1320000000 {
+			opp-hz = /bits/ 64 <1320000000>;
+			opp-microvolt-speed0 = <1100000>;
+			opp-microvolt-speed2 = <1100000>;
+			opp-microvolt-speed3 = <1100000>;
+			opp-microvolt-speed4 = <1100000>;
 			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0x1d>;
+		};
+
+		opp-1416000000 {
+			opp-hz = /bits/ 64 <1416000000>;
+			opp-microvolt-speed0 = <1100000>;
+			opp-microvolt-speed2 = <1100000>;
+			opp-microvolt-speed3 = <1100000>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0xd>;
+		};
+
+		opp-1512000000 {
 			opp-hz = /bits/ 64 <1512000000>;
-			opp-microvolt-speed0 = <1100000 1100000 1100000>;
-			opp-microvolt-speed1 = <1100000 1100000 1100000>;
-			opp-microvolt-speed2 = <1100000 1100000 1100000>;
+			opp-microvolt-speed1 = <1100000>;
+			opp-microvolt-speed3 = <1100000>;
+			clock-latency-ns = <244144>; /* 8 32k periods */
+			opp-supported-hw = <0xa>;
 		};
 	};
 };
-- 
2.34.1

